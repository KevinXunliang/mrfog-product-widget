<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>商品展示</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
        }
        #product-container {
            border: 1px solid #ddd;
            padding: 20px;
            max-width: 300px;
            margin: 0 auto;
            border-radius: 10px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.1);
        }
        img {
            max-width: 100%;
            border-radius: 5px;
        }
        button {
            padding: 10px;
            margin: 5px;
            cursor: pointer;
            border: none;
            border-radius: 5px;
        }
        .btn-primary {
            background-color: #007bff;
            color: white;
        }
        .btn-secondary {
            background-color: #28a745;
            color: white;
        }
    </style>
</head>
<body>

<div id="product-container">
    <h2 id="product-title">加载中...</h2>
    <img id="product-image" src="" alt="商品图片">
    <p id="product-price">价格：加载中...</p>
    <p id="product-stock">库存状态：加载中...</p>
    
    <button id="add-to-cart" class="btn-primary" disabled>加入购物车</button>
    <button id="buy-now" class="btn-secondary" disabled>立即购买</button>
</div>

<script>
    const productId = "4dce7916-8c75-433b-8d54-9b1d1ff45764";  // 替换成你的商品ID
    const shopDomain = "mrfog.online";  // 你的店铺域名
    const apiToken = "T19TxEjNE93o_kGSFMyp61dEOnusty20g8RdVDry29M";  // 你的API Token

    async function fetchProductData() {
        try {
            const response = await fetch(`https://${shopDomain}/openapi/2022-07/products/${productId}`, {
                headers: {
                    "Authorization": `Bearer ${apiToken}`,
                    "Content-Type": "application/json"
                }
            });

            if (!response.ok) {
                throw new Error(`API请求失败: ${response.status}`);
            }

            const product = await response.json();

            if (!product || !product.variants || product.variants.length === 0) {
                throw new Error("商品数据异常");
            }

            document.getElementById("product-title").textContent = product.title || "未知商品";
            document.getElementById("product-image").src = product.images && product.images.length > 0 
                ? product.images[0].src 
                : "默认图片URL";  
            document.getElementById("product-price").textContent = `价格：¥${product.variants[0].price || "未知"}`;
            document.getElementById("product-stock").textContent = `库存：${product.variants[0].inventory_quantity > 0 ? "有货" : "售罄"}`;

            const addToCartBtn = document.getElementById("add-to-cart");
            const buyNowBtn = document.getElementById("buy-now");

            if (product.variants[0].inventory_quantity > 0) {
                addToCartBtn.disabled = false;
                buyNowBtn.disabled = false;
            }

            addToCartBtn.onclick = async () => {
                try {
                    const cartResponse = await fetch(`https://${shopDomain}/openapi/2022-07/carts`, {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${apiToken}`,
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            line_items: [{ variant_id: product.variants[0].id, quantity: 1 }]
                        })
                    });

                    if (!cartResponse.ok) throw new Error(`加入购物车失败: ${cartResponse.status}`);

                    alert("已加入购物车！");
                } catch (error) {
                    alert("加入购物车失败，请重试。");
                    console.error(error);
                }
            };

            buyNowBtn.onclick = async () => {
                try {
                    const checkoutResponse = await fetch(`https://${shopDomain}/openapi/2022-07/checkouts`, {
                        method: "POST",
                        headers: {
                            "Authorization": `Bearer ${apiToken}`,
                            "Content-Type": "application/json"
                        },
                        body: JSON.stringify({
                            line_items: [{ variant_id: product.variants[0].id, quantity: 1 }]
                        })
                    });

                    if (!checkoutResponse.ok) throw new Error(`创建结账失败: ${checkoutResponse.status}`);

                    const checkoutData = await checkoutResponse.json();
                    window.location.href = checkoutData.checkout_url;
                } catch (error) {
                    alert("创建结账失败，请重试。");
                    console.error(error);
                }
            };

        } catch (error) {
            console.error("获取商品数据失败", error);
            document.getElementById("product-container").innerHTML = "<p>商品加载失败，请刷新重试。</p>";
        }
    }

    fetchProductData();
</script>

</body>
</html>
